<?php
require __DIR__ . '/../includes/auth.php';
require __DIR__ . '/../includes/db.php';

require_login();

$data = json_decode(file_get_contents('php://input'), true);
$theme = in_array($data['theme'] ?? '', ['light','dark'], true)
    ? $data['theme']
    : 'light';

$pdo->prepare("UPDATE users SET theme=? WHERE id=?")
    ->execute([$theme, $_SESSION['user']['id']]);

$_SESSION['user']['theme'] = $theme;